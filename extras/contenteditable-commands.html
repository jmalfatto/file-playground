<!DOCTYPE html>
<html>

<head>
    <title>Content-editable element with text-color highlights</title>

    <style>
        #editdiv {
            outline: 0px solid transparent;
        }
        [contenteditable=true]:empty:before {
            content: attr(placeholder);
            display: block;
            font-family: sans-serif;
            font-size: 12px;
            color: gray;
        }
    </style>
</head>

<body>

<input type="text" id="searchstr" value="red green blue"><br>
<br>
<div id="editdiv" contenteditable="true" placeholder="Type here...">thar be red in here</div>
<br>
<button onclick="hightlightText();">highlight listed words</button>

<script src="contenteditable-util.js"></script>
<script>
    var prohibitedWords = ['red', 'blue', 'green'];

    var util = contentEditableUtil;

    var searchstrEl = document.getElementById('searchstr');
    var containerEl = document.getElementById('editdiv');

    containerEl.addEventListener('keydown', onKeyDown, false);
    containerEl.addEventListener('focus', onFocusChange, false);
    containerEl.addEventListener('blur', onFocusChange, false);

    function onKeyDown(e) {
        var text = this.textContent.slice(0);
        var len = text.replace(/[\n\r]+/g, '').length;

        // maxlength: allow backspace and arrow left and right keys
        // prevent hard returns, which introduces bugs
        if ((len >= 50 && !isInertKeyCode(e.keyCode)) || e.keyCode === 13) {
            e.preventDefault();
        }

        // if space, left-arrow, or right-arrow, run check on prohibited words
        if (/^(32|37|39)$/.test(e.keyCode)) {
            debounce(checkProhibitedWords, 250)();
        }
    }

    function onFocusChange() {
        debounce(checkProhibitedWords, 250)();
    }

    function checkProhibitedWords() {
        var prohibited = searchstrEl.value.split(' ');

        util.saveCaret(containerEl);

        util.highlightAllProhibitedWords(containerEl, prohibited);

        util.restoreCaret(containerEl);
    }

    function debounce(func, wait, immediate) {
        var timeout;
        return function() {
            var context = this, args = arguments;
            var later = function() {
                timeout = null;
                if (!immediate) func.apply(context, args);
            };
            const callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) func.apply(context, args);
        };
    }

</script>
<script src="contenteditable-util.spec.js"></script>

</body>

</html>