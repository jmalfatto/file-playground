//Hermite resize - fast image resize/resample using Hermite filter.
//Author: ViliusL
//https://github.com/viliusle/Hermite-resize
//http://viliusle.github.io/miniPaint/
function Hermite_class(){var a,b=[];this.init=function(){a=navigator.hardwareConcurrency||4}(),this.getCores=function(){return a},this.resample_auto=function(a,b,c,d,e){var f=this.getCores();window.Worker&&f>1?this.resample(a,b,c,d,e):(this.resample_single(a,b,c,!0),e())},this.resample=function(c,d,e,f,g){var h=c.width,i=c.height;d=Math.round(d),e=Math.round(e);var j=Math.ceil(i/e/2);if(b.length>0)for(var k=0;k<a;k++)void 0!=b[k]&&(b[k].terminate(),delete b[k]);b=new Array(a);for(var l=c.getContext("2d"),m=new Array(a),n=new Array(a),k=0;k<a;k++){var o=Math.ceil(i/a)*k,p=Math.ceil(i/a)+j*a;if(o+p>i&&(p=i-o),!(p<1)){m[k]=l.getImageData(0,o,h,p);var o=Math.ceil(e/a)*k,p=Math.ceil(e/a);o+p>e&&(p=e-o),p<1||(n[k]=!0)}}f===!0?(c.width=d,c.height=e):l.clearRect(0,0,h,i);for(var q=0,k=0;k<a;k++)if(void 0!=n[k]){q++;var r=new Worker("../dist/hermite.worker.js");b[k]=r,r.onmessage=function(c){q--;var f=c.data.core;delete b[f],n[f]=l.createImageData(d,Math.ceil(e/a)),n[f].data.set(c.data.target);var h=Math.ceil(e/a)*f;l.putImageData(n[f],0,h),q<=0&&g()};var s={width_source:h,height_source:i,width:d,height:e,core:k,cores:a,source:m[k].data.buffer};r.postMessage(s,[s.source])}},this.resample_single=function(a,b,c,d){var e=a.width,f=a.height;b=Math.round(b),c=Math.round(c);for(var g=e/b,h=f/c,i=Math.ceil(g/2),j=Math.ceil(h/2),k=a.getContext("2d"),l=k.getImageData(0,0,e,f),m=k.createImageData(b,c),n=l.data,o=m.data,p=0;p<c;p++)for(var q=0;q<b;q++){for(var r=4*(q+p*b),s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=(p+.5)*h,A=Math.floor(p*h),B=Math.ceil((p+1)*h),C=A;C<B;C++)for(var D=Math.abs(z-(C+.5))/j,E=(q+.5)*g,F=D*D,G=Math.floor(q*g),H=Math.ceil((q+1)*g),I=G;I<H;I++){var J=Math.abs(E-(I+.5))/i,K=Math.sqrt(F+J*J);if(!(K>=1)){s=2*K*K*K-3*K*K+1;var L=4*(I+C*e);y+=s*n[L+3],u+=s,n[L+3]<255&&(s=s*n[L+3]/250),v+=s*n[L],w+=s*n[L+1],x+=s*n[L+2],t+=s}}o[r]=v/t,o[r+1]=w/t,o[r+2]=x/t,o[r+3]=y/u}d===!0?(a.width=b,a.height=c):k.clearRect(0,0,e,f),k.putImageData(m,0,0)}}